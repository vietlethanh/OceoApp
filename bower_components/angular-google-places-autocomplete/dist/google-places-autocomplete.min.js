"use strict";angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(a){return a.google}]).directive("gPlacesAutocomplete",["googlePlacesApi",function(a){function b(b,c,d,e){function f(){m={types:b.restrictType?[b.restrictType]:[],componentRestrictions:b.restrictCountry?{country:b.restrictCountry}:void 0},n=b.validLocationTypes?b.validLocationTypes.replace(/\s/g,"").split(","):[]}function g(){function d(a,b){var c;"keydown"==a&&(c=b,b=function(a){var b=$(".pac-item-selected").length>0;if((a.which==h.enter||a.which==h.tab)&&!b){var d=angular.element.Event("keydown",{keyCode:h.downArrow,which:h.downArrow});c.apply(f,[d])}c.apply(f,[a])}),g.apply(f,[a,b])}var f=c[0],g=f.addEventListener?f.addEventListener:f.attachEvent,h={tab:9,enter:13,downArrow:40};o=new a.maps.places.Autocomplete(f,m),c.bind("keydown",function(a){a.which==h.enter&&a.preventDefault()}),f.addEventListener?f.addEventListener=d:f.attachEvent&&(f.attachEvent=d),a.maps.event.addListener(o,"place_changed",function(){b.$apply(function(){e.$setViewValue(c.val())})})}function h(){e.$formatters.push(function(a){var b="";return _.isString(a)?b=a:_.isObject(a)&&(_.has(a,"formatted_address")?b=a.formatted_address:_.has(a,"name")&&(b=a.name)),b}),e.$parsers.push(function(a){var b=o.getPlace();return i(a,b),b}),e.$render=function(){c.val(e.$viewValue)}}function i(a,b){e.$setValidity("address",j(a,b)),e.$setValidity("locationType",k(b))}function j(a,c){if(b.forceSelection){if(null==c)return!1;if(_.isString(c))return!1;if(!_.has(c,"formatted_address"))return!1}return!0}function k(a){var b=!0;return _.isEmpty(n)||(b=a?l(a.types,n):!1),b}function l(a,b){var c;for(c=0;c<b.length;c++)if(_.contains(a,b[c]))return!0;return!1}var m,n,o;!function(){f(),g(),h()}()}return{restrict:"A",require:"ngModel",scope:{forceSelection:"=?",restrictType:"=?",restrictCountry:"=?",validLocationTypes:"@?"},link:b}}]);